# Euclid VIS multi-exposure shear inference — NGC 6505 test data
#
# Points to the bundled test data in data/EUC_VIS_SWL/.
# Selects the 600 brightest sources and runs MAP inference for quick testing.
#
# The `gal:` section specifies the probabilistic model: galaxy profile type,
# which parameters are latent variables (distributions) vs fixed, and what
# priors are used.  Parameters with `center: catalog` use per-source catalog
# values as the distribution location at runtime.

data:
  exposure_paths:
    - data/EUC_VIS_SWL/EUC_VIS_SWL-DET-002704-00-1-0000000__20241017T042756.626122Z_3-4-F.fits.gz
    - data/EUC_VIS_SWL/EUC_VIS_SWL-DET-002704-01-1-0000000__20241017T042805.678587Z_3-4-F.fits.gz
    - data/EUC_VIS_SWL/EUC_VIS_SWL-DET-002704-02-1-0000000__20241017T042754.590559Z_3-4-F.fits.gz
  psf_path: data/EUC_VIS_SWL/PSF_3-4-F.fits.gz
  catalog_path: data/EUC_VIS_SWL/catalogue_3-4-F.fits.gz
  background_paths:
    - data/EUC_VIS_SWL/EUC_VIS_SWL-BKG-002704-00-1-0000000__20241017T042756.626186Z_3-4-F.fits.gz
    - data/EUC_VIS_SWL/EUC_VIS_SWL-BKG-002704-01-1-0000000__20241017T042805.678757Z_3-4-F.fits.gz
    - data/EUC_VIS_SWL/EUC_VIS_SWL-BKG-002704-02-1-0000000__20241017T042754.590644Z_3-4-F.fits.gz
  quadrant: "3-4.F"
  pixel_scale: 0.1

sources:
  min_snr: 10.0
  require_vis_detected: true
  exclude_spurious: true
  exclude_deblended: false
  exclude_point_sources: true
  det_quality_exclude_mask: 0x78C
  max_sources: 600

# Galaxy model specification — the probabilistic model is explicit here.
# Each parameter is either a fixed value or a distribution (= latent variable).
gal:
  type: Exponential

  shear:
    type: G1G2
    g1: {type: Normal, mean: 0.0, sigma: 0.05}
    g2: {type: Normal, mean: 0.0, sigma: 0.05}

  # Catalog-centered priors: center="catalog" means the LogNormal median
  # is set to each source's catalog value at runtime.
  flux: {type: LogNormal, center: catalog, sigma: 0.5}
  half_light_radius: {type: LogNormal, center: catalog, sigma: 0.3}

  ellipticity:
    type: E1E2
    e1: {type: Normal, mean: 0.0, sigma: 0.3}
    e2: {type: Normal, mean: 0.0, sigma: 0.3}

  # Position offsets from catalog positions (in arcsec)
  position:
    type: Offset
    dx: {type: Normal, mean: 0.0, sigma: 0.05}
    dy: {type: Normal, mean: 0.0, sigma: 0.05}

inference:
  method: map
  map_config:
    enabled: true
    num_steps: 200
    learning_rate: 0.002
  rng_seed: 42

galaxy_stamp_sizes: [64, 128, 256]
background: fixed
output_dir: results/euclid
