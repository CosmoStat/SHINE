# Euclid VIS Quadrant Data — NGC 6505 (Observation 2704)

## Overview

This dataset contains a single VIS quadrant (3-4.F) extracted from three
overlapping deep exposures of NGC 6505, plus the corresponding background
maps, PSF model, and a merged source catalogue. The data comes from the
Euclid Q1 data release, downloaded via the ESA Euclid Science Archive
using `astroquery.esa.euclid`.

## Source observation

- **Target**: NGC 6505
- **Observation ID**: 2704
- **Mode**: DEEP
- **Instrument**: Euclid VIS
- **Observation date**: 2024-07-18
- **Exposure time**: 560.52s per frame
- **Sequence**: NOMINAL/SHORT (deep exposure only; short 90s calibration
  exposures excluded)
- **Pointing center**: RA=267.994, DEC=65.604

## Quadrant selection

The VIS focal plane is a 6×6 grid of CCDs, each read out through 4
quadrants (E, F, G, H), giving 144 quadrants per exposure. Quadrant
**3-4.F** was chosen as it is closest to the pointing center (173" offset).

## Dither overlap

Three dither positions (0, 1, 2) were selected from the four available.
All three mutually overlap in this quadrant:

| Pair         | Overlap |
|--------------|---------|
| dith0–dith1  | ~55%    |
| dith0–dith2  | ~18%    |
| dith1–dith2  | ~53%    |

Dither 3 was excluded because it does not overlap with dither 0 in this
quadrant.

## Files

### Exposure files (×3)

Each file contains 4 HDUs:

| HDU | Extension   | Shape         | Type    | Description                          |
|-----|-------------|---------------|---------|--------------------------------------|
| 0   | PRIMARY     | —             | Header  | Full observation metadata             |
| 1   | 3-4.F.SCI   | 2048 × 2066   | float32 | Calibrated science image (ADU)        |
| 2   | 3-4.F.RMS   | 2048 × 2066   | float32 | Per-pixel RMS noise map (ADU)         |
| 3   | 3-4.F.FLG   | 2048 × 2066   | int32   | Data quality bitmask                  |

Key header values per quadrant:
- `GAIN` — detector gain (e⁻/ADU), ~3.48
- `RDNOISE` — readout noise
- `EXPTIME` — integration time (560.52s)
- `MAGZEROP` — photometric zero-point (~24.57)
- `SATLEVEL` / `SATURATE` — saturation thresholds
- `PV1_*` / `PV2_*` — TPV astrometric distortion terms
- WCS uses `RA---TPV` / `DEC--TPV` projection

Photometric conversion:
```
m_AB = -2.5 * log10(ADU) + MAGZEROP + 2.5 * log10(EXPTIME)
```

Pixel data is in ADU, **not background-subtracted**. Use the companion
background map files (below) to subtract the background.

### Background map files (×3)

`EUC_VIS_SWL-BKG-*_3-4-F.fits` — one per dither, extracted from the
`DpdVisCalibratedQuadFrameBKG` auxiliary product.

| HDU | Extension | Shape         | Type    | Description                         |
|-----|-----------|---------------|---------|-------------------------------------|
| 0   | PRIMARY   | —             | Header  | Observation metadata                |
| 1   | 3-4.F     | 2048 × 2066   | float32 | Background map (ADU)                |

Each background map has the same WCS and dimensions as its corresponding
SCI image. Computed using NoiseChisel (effective at capturing straylight),
with fallback methods for robustness. Key header values:
- `BKG_MED` — median background level (MJy/sr)
- `BKG_MAD` — median absolute deviation (MJy/sr)

To background-subtract a science image:
```python
sci_sub = sci_data - bkg_data
```

### PSF file (×1)

`PSF_3-4-F.fits` — extracted from the `DpdVisCalibratedQuadFramePSF MODEL`
auxiliary product (generated by PSFex).

| HDU | Extension | Shape     | Description                        |
|-----|-----------|-----------|------------------------------------|
| 0   | PRIMARY   | —         | Header                             |
| 1   | 3-4.F     | 189 × 189 | 9×9 grid of 21×21 PSF stamps       |

The 189×189 image is a tiled grid of 81 PSF stamps (9 rows × 9 columns,
each 21×21 pixels), sampling the spatial variation of the PSF across the
quadrant. The stamps are arranged in row-major order corresponding to a
uniform grid over the 2048×2066 pixel quadrant.

Key PSF properties:
- Pixel scale: 0.1"/pixel (native VIS scale, 1× oversampling)
- Physical pixel size: 12 µm
- Stamp sums: ~0.93–0.97 (slight variation across field)
- FWHM: ~0.16" (~1.6 native pixels)

To extract a single PSF stamp at grid position (ix, iy):
```python
stamp = psf_data[iy*21:(iy+1)*21, ix*21:(ix+1)*21]
```
The center stamp (ix=4, iy=4) is representative of the quadrant average.

### Source catalogue (x1)

`catalogue_3-4-F.fits` — extracted from the Euclid MER (Merged) catalogue
(`catalogue.mer_catalogue`), queried over the union bounding box of all
three quadrant footprints (RA=[267.78, 268.12], DEC=[65.57, 65.67]).

Contains 6684 sources with the following columns:

| Column group       | Columns                                                                  |
|--------------------|--------------------------------------------------------------------------|
| **Identifiers**    | `object_id`                                                              |
| **Positions**      | `right_ascension`, `declination`, `right_ascension_psf_fitting`, `declination_psf_fitting` |
| **VIS fluxes**     | `flux_vis_2fwhm_aper`, `flux_vis_3fwhm_aper`, `flux_vis_psf`, `flux_detection_total`, `flux_segmentation` (+ errors) |
| **Morphology**     | `semimajor_axis`, `ellipticity`, `position_angle`, `kron_radius`, `fwhm` (+ errors) |
| **Classification** | `point_like_flag/prob`, `extended_flag/prob`, `spurious_flag/prob`        |
| **Quality**        | `flag_vis`, `vis_det`, `deblended_flag`, `det_quality_flag`              |
| **Other**          | `mu_max`, `mumax_minus_mag`, `segmentation_area`                         |

This is a merged catalogue derived from stacked images (not per-exposure),
so each source appears once regardless of how many exposures cover it.
Fluxes are in microJansky.

## How this data was obtained

1. Cone search on `q1.calibrated_frame` around NGC 6505 (0.5° radius)
   filtered to `instrument_name = 'VIS'`
2. Full calibrated frames downloaded via `Euclid.get_product()`
3. Background maps identified via `q1.aux_calibrated` where
   `stype = 'BKG'` and `observation_id = '2704'`
4. PSF file identified via `q1.aux_calibrated` where
   `stype = 'PSF MODEL'` and `observation_id = '2704'`
5. Quadrant 3-4.F (SCI/RMS/FLG) extracted from each deep exposure,
   preserving all original headers
6. Background map quadrant 3-4.F extracted from each BKG file
7. PSF stamp for 3-4.F extracted into a standalone file
8. MER merged catalogue queried via ADQL over the union footprint bounding
   box and saved as a FITS binary table

The script `prepare_quadrant_data.py` (included in this archive) reproduces
all of the above steps. It is idempotent — it skips downloads and
extractions for any files that already exist on disk. To re-run from
scratch, place the script in a directory (or a Colab `/content` folder)
and run:

```bash
python prepare_quadrant_data.py
```

Requirements: `astroquery`, `astropy`, `numpy`. The script will query the
ESA Euclid Science Archive (no authentication needed for Q1 public data).

## Archive access

- ESA Euclid Science Archive: https://eas.esac.esa.int/sas/
- Euclid Q1 release: https://euclid.esac.esa.int/dr/q1/
- Data product documentation: https://euclid.esac.esa.int/dr/q1/dpdd/
